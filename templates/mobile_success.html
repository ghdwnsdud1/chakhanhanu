<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì£¼ë¬¸ ì €ì¥ ì¤‘...</title>
</head>
<body>
  <h2>ì£¼ë¬¸ ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...</h2>
  <script>
  const url = new URL(window.location.href);
  const impUid = url.searchParams.get("imp_uid");

  const saved = localStorage.getItem("pendingOrder");
  if (!saved) {
    alert("âŒ ì£¼ë¬¸ ì •ë³´ê°€ ìœ ì‹¤ë˜ì—ˆìŠµë‹ˆë‹¤.");
  }

  const orderData = JSON.parse(saved);

  // í•„ìˆ˜ í•„ë“œ ë³´ì™„
  orderData.paymentMethod = "card";
  orderData.imp_uid = impUid;  // âœ… ì—¬ê¸°ê°€ í•µì‹¬ (snake_case)

  console.log("ğŸ“¦ ì „ì†¡í•  orderData:", orderData);

  fetch("https://chakhanhanu1.onrender.com/submit-order", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(orderData)
  })
  .then(res => {
    if (!res.ok) throw new Error("âŒ ì„œë²„ ì‘ë‹µ ì‹¤íŒ¨");
    return res.json();
  })
  .then(data => {
    alert("âœ… ì£¼ë¬¸ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
    localStorage.removeItem("pendingOrder");
    window.location.href = "/success";
  })
  .catch(err => {
    alert("âŒ ì£¼ë¬¸ ì €ì¥ ì‹¤íŒ¨: " + err.message);
    console.error(err);
  });
</script>
</body>
</html>
