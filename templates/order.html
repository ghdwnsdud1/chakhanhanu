<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì°©í•œí•œìš° ê³ ê¸° ì£¼ë¬¸ì„œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="google" content="notranslate">
  <style>
@font-face {
    font-family: 'Pretendard-Regular';
    src: url('https://fastly.jsdelivr.net/gh/Project-Noonnu/noonfonts_2107@1.1/Pretendard-Regular.woff') format('woff');
    font-weight: 400;
    font-style: normal;
}

select {
  text-align: center;
  text-align-last: center; /* ëŒ€ë¶€ë¶„ì˜ ë¸Œë¼ìš°ì €ì—ì„œ ë“œë¡­ë‹¤ìš´ ë‚´ í…ìŠ¤íŠ¸ ê°€ìš´ë° ì •ë ¬ */
  -moz-text-align-last: center; /* Firefox ëŒ€ì‘ */
  appearance: none; /* í”Œë«í¼ ìŠ¤íƒ€ì¼ ì œê±° */
  -webkit-appearance: none;
  -moz-appearance: none;
<select id="beefSelect" onchange="resetUIOnSelectChange('beef')">
}
  body, button, input, select, textarea, option {
    font-family: 'Cafe24Ssurround', sans-serif;
  }
    body {
      font-family: 'Noto Sans KR', sans-serif;
      padding: 20px;
      margin: 0;
      background-color: #fffaf0;
    }
    
    .container {
      max-width: 600px;
      margin: auto;
      border: 2px solid #d2a56e;
      border-radius: 20px;
      padding: 20px;
      background-color: #fff3dc;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    
    h1, h2, h3 {
      text-align: center;
    }
    
    .tabs {
      display: flex;
      justify-content: space-around;
      margin-bottom: 12px;
    }
    
    .tabs button {
      flex: 1;
      background-color: #fff7e6;
      border: 1px solid #d2a56e;
      padding: 10px;
      font-weight: bold;
      cursor: pointer;
      border-radius: 8px;
    }
    
    .tabs button.active {
      background-color: #f2dec0;
    }
    
    select {
      width: 100%;
      padding: 10px;
      margin: 12px 0;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 16px;
    }
    
    .meat-block {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 30px;
    }
    
    .qty-row {
      display: flex;
      justify-content: center;
      gap: 5px;
      align-items: center;
    }
    
    .qty-row button {
      width: 45px;
      height: 45px;
      font-size: 18px;
      background-color: #f2dec0;
      color: black;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      touch-action: manipulation;
    }
    
    .qty-row input[type="number"] {
      width: 150px;
      height: 42px;
      text-align: center;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    
    .add-btn {
      width: 100%;
      height: 45px;
      font-size: 18px;
      background-color: #d2a56e;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      display: block;
      margin: 0 auto;
    }
    
    .add-btn:hover {
      background-color: #c69c65;
    }
    
    button {
      cursor: pointer;
    }
    
    button:hover {
      opacity: 0.9;
    }
    
    button:disabled {
      background-color: #ccc;
    }
    
    .important {
      color: red;
      margin-left: 5px;
    }
    
    .button-group {
      display: flex;
      gap: 10px;
      margin: 20px 0;
    }
    
    .button-group button {
      flex: 1;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px;
      font-weight: bold;
    }
    
    #selectedItems, #requestSection, #addressSection, #paymentSection, #finalSection {
      margin-top: 20px;
      padding: 15px;
      background: #fff;
      border-radius: 8px;
      border: 1px solid #d2a56e;
    }
    
    .item {
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .item-buttons {
      display: flex;
      gap: 5px;
    }
    
    .action-btn {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
    }
    
    #finalAmount {
      font-size: 28px;
      text-align: center;
      margin-top: 10px;
      font-weight: bold;
    }
    
    input[type="text"], textarea, input[type="number"] {
      width: 90%;
      padding: 12px;
      margin: 10px 0;
      font-size: 16px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
.primary-button {
  background-color: #d2a56e !important;
  color: white !important;
  border: none !important;
  border-radius: 6px !important;
  padding: 12px !important;
  font-size: 18px !important;
  font-weight: bold !important;
  cursor: pointer;
  width: 100% !important;
  transition: background-color 0.2s ease;
}

.primary-button:hover {
  background-color: #c69c65 !important;
}

  </style>
   <script src="https://cdn.iamport.kr/js/iamport.payment-1.2.0.js"></script>
</head>

<body>
<div class="container">
  <h1>ğŸ® ì°©í•œí•œìš° ğŸ·</h1>
  <h2>ê³ ê¸° ì£¼ë¬¸ì„œ</h2>

  <!-- íƒ­ ë©”ë‰´ -->
  <div class="tabs">
    <button class="active" id="porkTab" onclick="changeTab('pork')">ë¼ì§€ê³ ê¸°</button>
    <button id="beefTab" onclick="changeTab('beef')">ì†Œê³ ê¸°</button>
    <button id="marinatedTab" onclick="changeTab('marinated')">ê°„í¸ì‹</button>
  </div>

  <!-- ë¼ì§€ê³ ê¸° -->
  <div id="porkSection" class="meat-section">
<p style="text-align: center; color: #b94a48; font-size: 14px; font-weight: bold; margin-bottom: 8px;">
  â€» ì´ìœ ì‹ìš© í¬í•¨, ë¼ì§€ê³ ê¸°Â·ì†Œê³ ê¸°ëŠ” ìµœëŒ€ <u>5,000g</u>ê¹Œì§€,<br>
  ê°„í¸ì‹ì€ ìµœëŒ€ <u>20ê°œ</u>ê¹Œì§€ë§Œ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤.
</p>
    <div class="meat-block">
      <select id="porkSelect" onchange="setDefaultQty('porkSelect','porkQty')">
  <option value="">-- ë¶€ìœ„ ì„ íƒ --</option>
</select>

      <div class="qty-row">
        <button onclick="changeQuantity('porkQty', -1, 'pork')">ï¼</button>
        <input type="number" id="porkQty" value="0" readonly>
        <button onclick="changeQuantity('porkQty', 1, 'pork')">ï¼‹</button>
        <span id="porkQtyDisplay">(í˜„ì¬ 0g)</span>
      </div>

      <button class="add-btn" onclick="addSelectedItem('pork')">ì¶”ê°€í•˜ê¸°</button>
    </div>
  </div>

  <!-- ì†Œê³ ê¸° -->
  <div id="beefSection" class="meat-section" style="display:none;">
<p style="text-align: center; color: #b94a48; font-size: 14px; font-weight: bold; margin-bottom: 8px;">
  â€» ì´ìœ ì‹ìš© í¬í•¨, ë¼ì§€ê³ ê¸°Â·ì†Œê³ ê¸°ëŠ” ìµœëŒ€ <u>5,000g</u>ê¹Œì§€,<br>
  ê°„í¸ì‹ì€ ìµœëŒ€ <u>20ê°œ</u>ê¹Œì§€ë§Œ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤.
</p>
    <div class="meat-block">
      <select id="beefSelect" onchange="setDefaultQty('beefSelect','beefQty')">
        <option value="">-- ë¶€ìœ„ ì„ íƒ --</option>
</select>

      <div class="qty-row">
        <button onclick="changeQuantity('beefQty', -1, 'beef')">ï¼</button>
        <input type="number" id="beefQty" value="0" readonly>
        <button onclick="changeQuantity('beefQty', 1, 'beef')">ï¼‹</button>
        <span id="beefQtyDisplay">(í˜„ì¬ 0g)</span>
      </div>

      <button class="add-btn" onclick="addSelectedItem('beef')">ì¶”ê°€í•˜ê¸°</button>
    </div>
  </div>

  <!-- ê°„í¸ì‹ -->
  <div id="marinatedSection" class="meat-section" style="display:none;">
<p style="text-align: center; color: #b94a48; font-size: 14px; font-weight: bold; margin-bottom: 8px;">
  â€» ì´ìœ ì‹ìš© í¬í•¨, ë¼ì§€ê³ ê¸°Â·ì†Œê³ ê¸°ëŠ” ìµœëŒ€ <u>5,000g</u>ê¹Œì§€,<br>
  ê°„í¸ì‹ì€ ìµœëŒ€ <u>20ê°œ</u>ê¹Œì§€ë§Œ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤.
</p>
    <div class="meat-block">
      <select id="marinatedSelect" onchange="setDefaultQty('marinatedSelect','marinatedQty'); resetUIOnSelectChange('marinated')">
        <option value="">-- ë¶€ìœ„ ì„ íƒ --</option>
</select>

      <div class="qty-row">
        <button onclick="changeQuantity('marinatedQty', -1, 'marinated')">ï¼</button>
        <input type="number" id="marinatedQty" value="0" readonly>
        <button onclick="changeQuantity('marinatedQty', 1, 'marinated')">ï¼‹</button>
        <span id="marinatedQtyDisplay">(í˜„ì¬ 0ê°œ)</span>
      </div>

      <button class="add-btn" onclick="addSelectedItem('marinated')">ì¶”ê°€í•˜ê¸°</button>
    </div>
  </div>
  
  <hr>

  <!-- ì„ íƒí•œ ìƒí’ˆ -->
  <div id="selectedItems">
    <h2>ğŸ›’ ì„ íƒí•œ ìƒí’ˆ</h2>
    <div id="itemsList"></div>
    <div id="totalWeight">ì´ ì¤‘ëŸ‰: 0g</div>
    <div id="totalPrice">ì´ ê¸ˆì•¡: 0ì›</div>
  </div>

  <hr>

  <!-- ìš”ì²­ì‚¬í•­ -->
  <div id="requestSection">
    <h2>ğŸ“ ìš”ì²­ì‚¬í•­</h2>
    <textarea id="request" placeholder="ì¶”ê°€ ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”" rows="4"></textarea>
  </div>

  <hr>

  <!-- ë°°ì†¡ì§€ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° -->
  <div class="button-group">
  <button type="button" class="primary-button" onclick="saveAddress()">ğŸ“¥ ë°°ì†¡ì§€ ì €ì¥</button>
  <button type="button" class="primary-button" onclick="loadAddress()">ğŸ“¤ ë°°ì†¡ì§€ ë¶ˆëŸ¬ì˜¤ê¸°</button>
</div>


  <!-- ë°°ì†¡ì§€ ì…ë ¥ -->
  <div id="addressSection">
    <h2>ğŸ“¦ ë°°ì†¡ì§€ ì…ë ¥</h2>
    <input type="text" id="contact" placeholder="ì—°ë½ì²˜ (ì˜ˆ: 010-1234-5678)" onkeyup="formatPhone(this)"> <span class="important">*</span>
    <input type="text" id="name" placeholder="ì´ë¦„"> <span class="important">*</span>
    <input type="text" id="address" placeholder="ì£¼ì†Œ"> <span class="important">*</span>
    <input type="text" id="doorcode" placeholder="ê³µë™í˜„ê´€ ë¹„ë°€ë²ˆí˜¸"> <span class="important">*</span>
    <textarea id="deliveryRequest" placeholder="ë°°ì†¡ ìš”ì²­ì‚¬í•­ (ì„ íƒ)" rows="3"></textarea>
  </div>

  <hr>

  <!-- ê²°ì œ ë°©ë²• -->
  <div id="paymentSection">
    <h2>ğŸ’³ ê²°ì œ ë°©ë²•</h2>

    <div class="button-group" style="margin-bottom: 20px;">
  <button id="cardPayButton" type="button" class="primary-button" onclick="payByCard()">ğŸ’³ ì¹´ë“œ ê²°ì œ</button>
  <button id="accountPayButton" type="button" class="primary-button" onclick="showAccountFields()">ğŸ¦ ê³„ì¢Œì´ì²´</button>
</div>

    <!-- ê³„ì¢Œì´ì²´ ì…ë ¥ì¹¸ (ì²˜ìŒì—” ìˆ¨ê¹€) -->
    <div id="accountFields" style="display: none; margin-top: 10px;">
      <input type="text" id="depositorName" placeholder="ì…ê¸ˆìëª… (í•„ìˆ˜)">
      <input type="text" id="cashReceipt" placeholder="í˜„ê¸ˆì˜ìˆ˜ì¦ ë²ˆí˜¸ (ì„ íƒ)"><br>
    ğŸ’³ <strong>ì…ê¸ˆ ê³„ì¢Œ</strong>: <span style="color: #333333; font-weight: bold;">ë†í˜‘ 351-1189-6544-63(ê¹€íƒœì¢…)</span><br>
      <button id="accountConfirmButton" type="button" class="primary-button" onclick="confirmAccountPayment()">âœ… í™•ì¸</button>

    </div>

    <div id="consentSection" style="margin-top: 20px; display: block;">
      <label style="font-size: 14px;">
        <input type="checkbox" id="privacyConsent">
        <b>[í•„ìˆ˜]</b> ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤. (ì´ë¦„, ì—°ë½ì²˜, ì£¼ì†Œ, ê³µë™í˜„ê´€ ë¹„ë°€ë²ˆí˜¸ ìˆ˜ì§‘ / ë°°ì†¡ ì™„ë£Œ í›„ 30ì¼ ì´ë‚´ íŒŒê¸°)
      </label>
      <br>
      <label style="font-size: 14px; margin-top: 10px; display: block;">
        <input type="checkbox" id="refundConsent">
        <b>[í•„ìˆ˜]</b> í™˜ë¶ˆ ë° êµí™˜ ì •ì±…ì— ë™ì˜í•©ë‹ˆë‹¤. <br>
        - <u>ì„œë¹„ìŠ¤ ì œê³µ ê¸°ê°„</u>: ê²°ì œì¼ë¡œë¶€í„° 1~3ì¼ ì´ë‚´ ë°°ì†¡ë©ë‹ˆë‹¤.<br>
        - <u>ì·¨ì†Œ ë° í™˜ë¶ˆ</u>: í¬ì¥ ì¤€ë¹„ ì „ê¹Œì§€ ì£¼ë¬¸ ì·¨ì†Œ ë° í™˜ë¶ˆì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br>
        - <u>êµí™˜ ë° í™˜ë¶ˆ</u>: ì œí’ˆ í•˜ì ì‹œ, ìˆ˜ë ¹ í›„ 24ì‹œê°„ ì´ë‚´ ë¬¸ì˜ ì‹œ êµí™˜ ë˜ëŠ” í™˜ë¶ˆí•´ë“œë¦½ë‹ˆë‹¤.<br>
        - ë¬¸ì˜: ì¹´ì¹´ì˜¤í†¡ ë˜ëŠ” ë§¤ì¥ (031-500-8876)
      </label>
    </div>
    <input type="hidden" id="paymentMethod">
  </div>

  <hr>

  <!-- ì´ ê²°ì œ ê¸ˆì•¡ -->
  <div id="finalSection">
    <h2>ğŸ§¾ ì´ ê²°ì œ ê¸ˆì•¡</h2>
    <div id="finalAmount">0ì›</div>
  </div>
</div>

<form id="paymentForm" method="POST" action="https://mobile.inicis.com/smart/payment/" target="_blank">
  <input type="hidden" name="P_INI_PAYMENT" value="CARD">
  <input type="hidden" name="P_MID" value="MOI2455267">
  <input type="hidden" name="P_OID" value="">
  <input type="hidden" name="P_AMT" value="">
  <input type="hidden" name="P_UNAME" value="">
  <input type="hidden" name="P_GOODS" value="">
  <input type="hidden" name="P_RETURN_URL" value="https://chakhanhanu.onrender.com/payment-result">
  <input type="hidden" name="P_NEXT_URL" value="https://chakhanhanu.onrender.com/success">
  <input type="hidden" name="P_NOTI_URL" value="https://chakhanhanu.onrender.com/payment-notify">
</form>

<footer style="margin-top: 50px; font-size: 12px; color: #666; text-align: center; line-height: 1.6;">
  <div>ìƒí˜¸ëª…: ì°©í•œí•œìš° | ëŒ€í‘œìëª…: ê¹€íƒœì¢… | ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸: 154-71-00398</div>
  <div>ì‚¬ì—…ì¥ì£¼ì†Œ: (14922) ê²½ê¸° ì‹œí¥ì‹œ ì€ê³„ë‚¨ë¡œ 11, ìƒê°€2ë™ 106í˜¸(í›„ë¬¸ìƒê°€) ì°©í•œí•œìš°</div>
  <div>ì „í™”ë²ˆí˜¸: 031-500-8876</div>
  <div>í†µì‹ íŒë§¤ì—…ë²ˆí˜¸: (2021-ê²½ê¸°ì‹œí¥-2287)</div>
  <div style="margin-top: 10px;">
    <a href="/terms" style="color: #666; text-decoration: underline;">ì´ìš©ì•½ê´€</a> | 
    <a href="/privacy" style="color: #666; text-decoration: underline;">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
  </div>
</footer>

<script>
// ë¨¼ì € ì „ì—­ ë³€ìˆ˜ì™€ í•¨ìˆ˜ë“¤ì„ ì„ ì–¸í•´ìš”
const porkList = {
  "ì‚¼ê²¹ì‚´": 2967, "ì˜¤ê²¹ì‚´": 3134, "ëª©ì‚´": 2634, "ì•ë‹¤ë¦¬ì‚´": 1650, "ì°Œê°œìš©": 1650,
  "ë“±ê°ˆë¹„": 2967, "ê°ˆë¹—ëŒ€ë²Œì§‘ì‚¼ê²¹ì‚´": 3300, "ìƒ ëŒ€íŒ¨ì‚¼ê²¹ì‚´": 2967, "ëˆ ë“±ì‹¬": 1650,
  "ëˆ ì•ˆì‹¬": 1650, "í•­ì •ì‚´": 6500, "ê°€ë¸Œë¦¬ì‚´(ë“±ì‹¬ë§ì‚´)": 5500, "ê°ˆë§¤ê¸°ì‚´": 5000,
  "ê¼¬ë“¤ì‚´": 3800, "ì• ì‚¬íƒœ(ê»ì§ˆO)": 1967, "ë¼ì§€ê°ˆë¹„": 1650
};
const beefList = {
  "í•œìš° ê½ƒë“±ì‹¬": 16800, "í•œìš° ì±„ëë“±ì‹¬": 18000, "í•œìš° ì•ˆì‹¬": 18800, "í•œìš° ì¹˜ë§ˆì‚´": 21800,
  "í•œìš° ì‚´ì¹˜ì‚´": 21800, "í•œìš° ê½ƒê°ˆë¹„ì‚´": 21800, "í•œìš° ë¶€ì±„ì‚´": 18000, "í•œìš° ì—…ì§„ì‚´": 18000,
  "í•œìš° ê°ˆë¹„ì‚´": 16800, "í•œìš° ì œë¹„ì¶”ë¦¬": 18000, "í•œìš° ì•ˆì°½ì‚´": 29800, "í•œìš° í† ì‹œì‚´": 21800,
  "í•œìš° ì–‘ì§€ êµ­ê±°ë¦¬": 7500, "í•œìš° ëª©ì‹¬ ì–‘ì§€": 5000, "í•œìš° ì‚¬íƒœ": 5000,
  "í•œìš° ìš°ë‘”ì‚´": 7000, "í•œìš° ë‹¤ì§ìœ¡": 7000, "í•œìš° ìœ¡íšŒ": 7500, "í•œìš° ì´ìœ ì‹ìš© ì•ˆì‹¬": 18800, "í•œìš° ì´ìœ ì‹ìš© ìš°ë‘”ì‚´": 7000
};
const marinatedList = {
  "í•œìš° ì‚¬ê³¨ê³°íƒ•": 6000,
  "í•œìš° ê³ ê¸°ë“¬ë¿ ì‚¬ê³¨ê³°íƒ•": 10000,
  "ê³ ì¶”ì¥ ìˆœì‚´ ë‹­ê°ˆë¹„ 700g": 9900,
  "í•œëˆ ê³ ì¶”ì¥ ë¶ˆê³ ê¸° 800g": 8900,
  "í•œëˆ ìƒ ì–‘ë…ëª©ì‚´ 900g": 14800,
  "í•œìš° 1++ ì°¹ìŠ¤í…Œì´í¬ 360g": 16800,
  "ë„ˆë¥¼ ê½ ì°œë‹­ 800g": 10800
};
let selectedItems = [];

// íƒ­ ë³€ê²½ í•¨ìˆ˜
function changeTab(type) {
  // ëª¨ë“  íƒ­ ì„¹ì…˜ ìˆ¨ê¸°ê¸°
  document.querySelectorAll('.meat-section').forEach(section => {
    section.style.display = 'none';
  });
  
  // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
  document.querySelectorAll('.tabs button').forEach(button => {
    button.classList.remove('active');
  });
  
  // ì„ íƒí•œ íƒ­ í‘œì‹œ ë° ë²„íŠ¼ í™œì„±í™”
  document.getElementById(type + 'Section').style.display = 'block';
  document.getElementById(type + 'Tab').classList.add('active');
}

function setDefaultQty(selectId, qtyId) {
  const selected = document.getElementById(selectId).value;
  const type = selectId.replace("Select", ""); // porkSelect â†’ pork

  if (selected) {
    let qty = 100;

    if (type === "marinated") {
      qty = 1;
    } else if (type === "beef" && (selected.includes("ê½ƒë“±ì‹¬") || selected.includes("ì±„ë"))) {
      qty = 200;
    } else if (type === "beef" && (selected.includes("ì´ìœ ì‹"))) {
      qty = 10;
    } else if (type === "pork" && selected === "ë¼ì§€ê°ˆë¹„") {
      qty = 1200;
    }

    document.getElementById(qtyId).value = qty;
    updateQtyDisplay(type); // âœ… ì„ íƒê³¼ ë™ì‹œì— í‘œì‹œë„ ê°±ì‹ !
  }
}


function updateQtyDisplay(type) {
  let select, qtyInput, display;
  if (type === 'pork') {
    select = document.getElementById('porkSelect');
    qtyInput = document.getElementById('porkQty');
    display = document.getElementById('porkQtyDisplay');
  } else if (type === 'beef') {
    select = document.getElementById('beefSelect');
    qtyInput = document.getElementById('beefQty');
    display = document.getElementById('beefQtyDisplay');
  } else if (type === 'marinated') {
    select = document.getElementById('marinatedSelect');
    qtyInput = document.getElementById('marinatedQty');
    display = document.getElementById('marinatedQtyDisplay');
  }

  const meat = select.value;
  const quantity = parseInt(qtyInput.value) || 0;

  let displayText = '';

  if (type === 'marinated') {
    displayText = `(í˜„ì¬ ${quantity}ê°œ)`;
  } else if (type === 'beef' && (meat === 'ì´ìœ ì‹ìš© ì•ˆì‹¬' || meat === 'ì´ìœ ì‹ìš© ìš°ë‘”ì‚´')) {
    displayText = `(í˜„ì¬ ${quantity * 10}g)`;  // ì´ìœ ì‹ì€ 10g ë‹¨ìœ„
  } else {
    displayText = `(í˜„ì¬ ${quantity}g)`;
  }

  if (display) {
    display.textContent = displayText;
  }
}

function changeQuantity(id, delta, type) {
  const input = document.getElementById(id);
  const select = document.getElementById(type + 'Select');
  const current = parseInt(input.value) || 0;

  let step = 100;
  let max = 5000;
  let min = 100;

  // ğŸ”¥ ì´ìœ ì‹ìš©ì´ë©´ 10g ë‹¨ìœ„ë¡œ ë³€ê²½
  const selectedMeat = select.value;
  if (type === 'beef' && (selectedMeat === 'í•œìš° ì´ìœ ì‹ìš© ì•ˆì‹¬' || selectedMeat === 'í•œìš° ì´ìœ ì‹ìš© ìš°ë‘”ì‚´')) {
    step = 10;
    min = 10;
    max = 600;
  } else if (type === 'beef' && (selectedMeat.includes("ê½ƒë“±ì‹¬") || selectedMeat.includes("ì±„ë"))) {
    min = 200;
  } else if (type === 'marinated') {
    step = 1;
    min = 1;
    max = 20;
  } else if (type === 'pork' && selectedMeat === 'ë¼ì§€ê°ˆë¹„') {
    min = 1200;
  }

  const updated = Math.min(max, Math.max(min, current + delta * step));
  input.value = updated;
  updateQtyDisplay(type);
}

function addSelectedItem(type) {
  let select, qtyInput, priceList;
  if (type === 'pork') {
    select = document.getElementById('porkSelect');
    qtyInput = document.getElementById('porkQty');
    priceList = porkList;
  } else if (type === 'beef') {
    select = document.getElementById('beefSelect');
    qtyInput = document.getElementById('beefQty');
    priceList = beefList;
  } else if (type === 'marinated') {
    select = document.getElementById('marinatedSelect');
    qtyInput = document.getElementById('marinatedQty');
    priceList = marinatedList;
  }

  const meat = select.value;
  
  // ğŸ’¡ ì—¬ê¸°ì„œ ìˆ˜ëŸ‰ ë‹¨ìœ„ ì¡°ê±´ë¶€ ì„¤ì •
  let quantity;
  if (type === 'marinated') {
    quantity = parseInt(qtyInput.value) || 1;  // ì–‘ë…ìœ¡ì€ ê°œìˆ˜
  } else if (type === 'beef' && (meat === 'ì´ìœ ì‹ìš© ì•ˆì‹¬' || meat === 'ì´ìœ ì‹ìš© ìš°ë‘”ì‚´')) {
    quantity = parseInt(qtyInput.value) || 10; // ì´ìœ ì‹ì€ 10g ë‹¨ìœ„
  } else if (type === 'beef' && (meat.includes("ê½ƒë“±ì‹¬") || meat.includes("ì±„ë"))) {
    quantity = parseInt(qtyInput.value) || 200; // ê½ƒë“±ì‹¬/ì±„ëì€ 200gë¶€í„°
  } else {
    quantity = parseInt(qtyInput.value) || 100; // ë‚˜ë¨¸ì§€ëŠ” 100g ë‹¨ìœ„
  }

  if (!meat || quantity <= 0) {
    alert("ë¶€ìœ„ì™€ ìˆ˜ëŸ‰ì„ ì •í™•íˆ ì„ íƒí•´ì£¼ì„¸ìš”.");
    return;
  }

  const weight = quantity;  // g ë˜ëŠ” ê°œìˆ˜ ê·¸ëŒ€ë¡œ ì‚¬ìš©
  const pricePerUnit = priceList[meat];
  const existing = selectedItems.find(item => item.meat === meat);
  if (existing) {
    existing.weight += weight;
    if (existing.quantity !== undefined) {
      existing.quantity += quantity;
    }
  } else {
    selectedItems.push({
      meat: meat,
      weight: weight,
      pricePerUnit: pricePerUnit,
      type: type,
      quantity: quantity
    });
  }
  updateList();
  select.selectedIndex = 0;  // ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
  qtyInput.value = 0;        // ìˆ˜ëŸ‰ ì´ˆê¸°í™”
  updateQtyDisplay(type); 
}

function updateList() {
  const itemsList = document.getElementById('itemsList');
  itemsList.innerHTML = '';
  let totalWeight = 0;
  let totalCount = 0;
  let totalPrice = 0;
  selectedItems.forEach((item, index) => {
    let itemPrice = 0;
    if (item.type === 'marinated') {
      itemPrice = item.weight * item.pricePerUnit;
      totalCount += item.weight;
    } else {
      itemPrice = Math.floor(item.weight * item.pricePerUnit / 100);
      totalWeight += item.weight;
    }
    const formattedWeight = item.weight.toLocaleString() + (item.type === 'marinated' ? 'ê°œ' : 'g');
    const formattedPrice = itemPrice.toLocaleString();
    const div = document.createElement('div');
    div.className = 'item';
    div.innerHTML = `
      ${item.meat} - ${formattedWeight} - ${formattedPrice}ì›
      <div class="item-buttons">
        <button class="action-btn" onclick="editItem(${index})">âœï¸</button>
        <button class="action-btn" onclick="removeItem(${index})">ğŸ—‘ï¸</button>
      </div>
    `;
    itemsList.appendChild(div);
    totalPrice += itemPrice;
  });
  const roundedPrice = Math.floor(totalPrice / 10) * 10;
  document.getElementById('totalWeight').textContent = `ì´ ì¤‘ëŸ‰: ${totalWeight.toLocaleString()}g / ì´ ìˆ˜ëŸ‰: ${totalCount.toLocaleString()}ê°œ`;
  document.getElementById('totalPrice').textContent = `ì´ ê¸ˆì•¡: ${roundedPrice.toLocaleString()}ì›`;
  document.getElementById('finalAmount').textContent = `${roundedPrice.toLocaleString()}ì›`;
  checkSubmitEnabled();
}

function editItem(index) {
  const item = selectedItems[index];
  const message = item.type === 'marinated' ? "ìƒˆ ìˆ˜ëŸ‰ (ê°œ ë‹¨ìœ„)" : "ìƒˆ ì¤‘ëŸ‰ (10g ë‹¨ìœ„)";
  const newWeight = prompt(message, item.weight);
  if (newWeight !== null) {
    const parsed = parseInt(newWeight);
    if (!isNaN(parsed)) {
      if (item.type === 'marinated' || parsed % 10 === 0) {
        selectedItems[index].weight = parsed;
        updateList();
      } else {
        alert("ê³ ê¸°ëŠ” 10g ë‹¨ìœ„ë¡œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.");
      }
    } else {
      alert("ìˆ«ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    }
  }
}

function decreaseQuantity() {
  const select = document.querySelector("select:visible");
  const selectedMeat = select.value;
  const input = document.getElementById(select.id.replace("Select", "Qty"));
  let current = parseInt(input.value) || 0;

  let min = 100;
  if (selectedMeat.includes("ê½ƒë“±ì‹¬") || selectedMeat.includes("ì±„ë")) {
    min = 200;
  } else if (selectedMeat.includes("ì´ìœ ì‹")) {
    min = 10;
  } else if (select.id.includes("marinated")) {
    min = 1;
  }

  if (current > min) {
    input.value = current - min;
  }
}

function resetUIOnSelectChange(type) {
  // ìˆ˜ëŸ‰ ì´ˆê¸°í™”
  const qtyInput = document.getElementById(type + "Qty");
  const select = document.getElementById(type + "Select");
  const selectedMeat = select.value;

  if (selectedMeat.includes("ê½ƒë“±ì‹¬") || selectedMeat.includes("ì±„ë")) {
    qtyInput.value = 200;
  } else if (selectedMeat.includes("ì´ìœ ì‹")) {
    qtyInput.value = 10;
  } else if (type === "marinated") {
    qtyInput.value = 1;
  } else {
    qtyInput.value = 100;
  }

  console.log("Reset UI called:", type, " â†’ ", qtyInput.value);
  updateQtyDisplay(type);
}

function removeItem(index) {
  selectedItems.splice(index, 1);
  updateList();
}

function saveAddress() {
  const info = {
    contact: document.getElementById('contact').value,
    name: document.getElementById('name').value,
    address: document.getElementById('address').value,
    doorcode: document.getElementById('doorcode').value,
    deliveryRequest: document.getElementById('deliveryRequest').value
  };
  localStorage.setItem('shippingInfo', JSON.stringify(info));
  alert('ë°°ì†¡ì§€ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
}

function loadAddress() {
  const saved = localStorage.getItem('shippingInfo');
  if (saved) {
    const info = JSON.parse(saved);
    document.getElementById('contact').value = info.contact || '';
    document.getElementById('name').value = info.name || '';
    document.getElementById('address').value = info.address || '';
    document.getElementById('doorcode').value = info.doorcode || '';
    document.getElementById('deliveryRequest').value = info.deliveryRequest || '';
    alert('ë°°ì†¡ì§€ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!');
  } else {
    alert('ì €ì¥ëœ ë°°ì†¡ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.');
  }
}

function payByCard() {
  if (!validateBeforePayment()) return;

  const name = document.getElementById('name').value;
  const amount = Number(document.getElementById('finalAmount').innerText.replace(/[^0-9]/g, ''));
  const contact = document.getElementById('contact').value;
  const address = document.getElementById('address').value;
  const token = document.getElementById('token').value;

  const orderData = {
    name: name,
    contact: contact,
    address: address,
    totalAmount: amount,
    token: token
  };

// ëª¨ë°”ì¼ ë¦¬ë””ë ‰ì…˜ ëŒ€ë¹„: localStorageì— ì„ì‹œ ì €ì¥
  localStorage.setItem("pendingOrder", JSON.stringify(orderData));

  const IMP = window.IMP;
  IMP.init('imp20083434'); // ì—¬ê¸°ë‹¤ê°€ ë„ˆ í¬íŠ¸ì› 'ê°€ë§¹ì  ì‹ë³„ì½”ë“œ' ë„£ì–´ì•¼ í•´!! (ex: imp_1234567890)

  IMP.request_pay({
    pg : 'html5_inicis',  // ì´ë‹ˆì‹œìŠ¤
    merchant_uid: 'order_' + Date.now(), // ì£¼ë¬¸ë²ˆí˜¸ (ê³ ìœ í•´ì•¼ í•´)
    name : 'ì°©í•œí•œìš° ê³ ê¸° ì£¼ë¬¸',
    amount : amount,
    tax_free: amount,
    buyer_name : name,
    buyer_tel : contact,
    buyer_addr : address,
    buyer_postcode : '' , // ìš°í¸ë²ˆí˜¸ í•„ìš”ì—†ìœ¼ë©´ ë¹„ì›Œë‘¬

   m_redirect_url: 'https://chakhanhanu1.onrender.com/mobile-payment-success'  // â† ë°˜ë“œì‹œ ë°°í¬ëœ ì„œë²„ ì£¼ì†Œë¡œ ë°”ê¿”ì¤˜ì•¼ í•¨!
  }, function (rsp) {
    if (rsp.success) {
      alert('ê²°ì œê°€ ì„±ê³µí–ˆìŠµë‹ˆë‹¤!\nê²°ì œë²ˆí˜¸: ' + rsp.imp_uid);

      // âœ… PCí™˜ê²½ì—ì„œëŠ” ì—¬ê¸°ì„œ ì§ì ‘ ì„œë²„ì— ì „ì†¡
      saveOrderToServer('card', rsp.imp_uid)
        .then(() => {
          window.location.href = '/success';
        })
        .catch(err => {
          alert("âŒ ì£¼ë¬¸ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
          console.error(err);
        });
    } else {
      alert('âŒ ê²°ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + rsp.error_msg);
    }
  });
}

function createRandomToken() {
  return (crypto.randomUUID) ? crypto.randomUUID() : Math.random().toString(36).substr(2, 10);
}

function showAccountFields() {
  document.getElementById('paymentMethod').value = 'account';
  document.getElementById('accountFields').style.display = 'block';
}

function confirmAccountPayment() {
  document.getElementById('paymentMethod').value = 'account';
  if (!validateBeforePayment(true)) return;
  alert('ê³„ì¢Œì´ì²´ ì£¼ë¬¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\nì§€ì •ëœ ê³„ì¢Œë¡œ ì†¡ê¸ˆ ë¶€íƒë“œë¦½ë‹ˆë‹¤.');
  
  saveOrderToServer('account');  // ì„œë²„ì— ì €ì¥ ì‹œë„

  // ğŸ”¥ ì €ì¥ ì„±ê³µí•˜ë©´ ì´ë™í•´ì•¼ í•´. ë°”ë¡œ ì´ë™ì‹œí‚¤ì§€ ë§ê³ !
}

function validateBeforePayment(isAccount = false) {
  if (!selectedItems.length) {
    alert('ìƒí’ˆì„ ì„ íƒí•´ì£¼ì„¸ìš”!');
    return false;
  }
  if (!document.getElementById('contact').value.trim()) {
    alert('ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
    return false;
  }
  if (!document.getElementById('name').value.trim()) {
    alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
    return false;
  }
  if (!document.getElementById('address').value.trim()) {
    alert('ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
    return false;
  }
  if (!document.getElementById('privacyConsent').checked || !document.getElementById('refundConsent').checked) {
    alert('ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° í™˜ë¶ˆ ì •ì±…ì— ë™ì˜í•´ ì£¼ì„¸ìš”!');
    return false;
  }
  if (isAccount) {
    const depositorName = document.getElementById('depositorName').value.trim();
    if (!depositorName) {
      alert('ì…ê¸ˆìëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
      return false;
    }
  }
  return true;
}

function checkSubmitEnabled() {
  const hasItems = selectedItems.length > 0;
  const hasContact = document.getElementById('contact').value.trim() !== '';
  const hasName = document.getElementById('name').value.trim() !== '';
  const hasAddress = document.getElementById('address').value.trim() !== '';
  const paymentMethod = document.getElementById('paymentMethod').value.trim();
  const privacyConsent = document.getElementById('privacyConsent');
  const refundConsent = document.getElementById('refundConsent');
  
  let privacyChecked = true;
  let refundChecked = true;
  let depositorChecked = true;
  
  // ê²°ì œ ë°©ë²• ê³¨ëì„ ë•Œë§Œ ê°œì¸ì •ë³´/í™˜ë¶ˆ ë™ì˜ ê²€ì‚¬
  if (document.getElementById('consentSection').style.display === 'block') {
    privacyChecked = privacyConsent && privacyConsent.checked;
    refundChecked = refundConsent && refundConsent.checked;
  }
  if (paymentMethod === 'account') {
    const depositorName = document.getElementById('depositorName').value.trim();
    depositorChecked = depositorName !== '';
  }
}

function saveOrderToServer(paymentMethod, imp_uid = '') {
  const orderData = {
    items: selectedItems,
    totalAmount: document.getElementById('finalAmount').innerText,
    contact: document.getElementById('contact').value,
    name: document.getElementById('name').value,
    address: document.getElementById('address').value,
    doorcode: document.getElementById('doorcode')?.value || '',
    requestMessage: document.getElementById('request')?.value || '',
    deliveryRequest: document.getElementById('deliveryRequest')?.value || '',
    paymentMethod: paymentMethod,
    depositorName: document.getElementById('depositorName')?.value || '',
    cashReceipt: document.getElementById('cashReceipt')?.value || '',
    imp_uid: imp_uid,
    isPaid: paymentMethod === 'card',
    token: createRandomToken()
  };

  fetch('/submit-order', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(orderData)
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      console.log("âœ… ì£¼ë¬¸ ì €ì¥ ì„±ê³µ");
      window.location.href = '/success';  // âœ… ì—¬ê¸°ì„œ ë°”ë¡œ ì´ë™!
    } else {
      alert("âŒ ì£¼ë¬¸ ì €ì¥ ì‹¤íŒ¨");
    }
  })
  .catch(err => {
    alert("ì„œë²„ ì˜¤ë¥˜ë¡œ ì£¼ë¬¸ ì €ì¥ ì‹¤íŒ¨");
    console.error(err);
  });
}


// DOMContentLoaded ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆëŠ” ìœ ì§€í•˜ë˜, ì•ˆìª½ ë‚´ìš©ì„ ì¤„ì—¬ìš”
document.addEventListener('DOMContentLoaded', function () {
  // í˜ì´ì§€ ë¡œë”© ì‹œ ê¸°ë³¸ íƒ­ ì„¤ì •
  changeTab('pork');
  
  // ì—°ë½ì²˜ í¬ë§·íŒ… ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
  document.getElementById('contact').addEventListener('input', function(e) {
    let num = e.target.value.replace(/\D/g, '');
    if (num.length < 4) {
      e.target.value = num;
    } else if (num.length < 8) {
      e.target.value = num.slice(0, 3) + '-' + num.slice(3);
    } else {
      e.target.value = num.slice(0, 3) + '-' + num.slice(3, 7) + '-' + num.slice(7, 11);
    }
  });
  
  // ë‹¤ë¥¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤ ì¶”ê°€
  document.getElementById('contact').addEventListener('input', checkSubmitEnabled);
  document.getElementById('name').addEventListener('input', checkSubmitEnabled);
  document.getElementById('address').addEventListener('input', checkSubmitEnabled);
  document.getElementById('privacyConsent').addEventListener('change', checkSubmitEnabled);
  document.getElementById('refundConsent').addEventListener('change', checkSubmitEnabled);
  document.getElementById('depositorName').addEventListener('input', checkSubmitEnabled);
});
fetch("/get-products")
  .then(res => res.json())
  .then(data => {
    const porkSelect = document.getElementById("porkSelect");
    const beefSelect = document.getElementById("beefSelect");
    const marinatedSelect = document.getElementById("marinatedSelect");

    porkSelect.innerHTML = '<option value="">-- ë¶€ìœ„ ì„ íƒ --</option>';
    beefSelect.innerHTML = '<option value="">-- ë¶€ìœ„ ì„ íƒ --</option>';
    marinatedSelect.innerHTML = '<option value="">-- ë¶€ìœ„ ì„ íƒ --</option>';

    data.forEach(item => {
      const option = document.createElement("option");
      option.value = item.name;
      let label = item.name;

      if (item.category === "ë¼ì§€ê³ ê¸°") {
        label += ` (100g ${item.price.toLocaleString()}ì›)`;
      } else if (item.category === "ì†Œê³ ê¸°") {
        label += ` (100g ${item.price.toLocaleString()}ì›)`;
      } else {
        label += ` (${item.price.toLocaleString()}ì›)`;
      }

      if (item.status.includes("í’ˆì ˆ")) {
        option.disabled = true;
        label += " - í’ˆì ˆ";
      }

      option.textContent = label;

      if (item.category === "ë¼ì§€ê³ ê¸°") {
  porkSelect.appendChild(option);
  porkList[item.name] = item.price;  // ğŸ’¡ ì—¬ê¸°ë„
}
if (item.category === "ì†Œê³ ê¸°") {
  beefSelect.appendChild(option);
  beefList[item.name] = item.price;  // ğŸ’¡ ì—¬ê¸°ë„
}
if (item.category === "ê°„í¸ì‹") {
  marinatedSelect.appendChild(option);
  marinatedList[item.name] = item.price;  // ğŸ’¡ ì—¬ê¸°ë„
}
    });
  });
</script>
</body>
</html>