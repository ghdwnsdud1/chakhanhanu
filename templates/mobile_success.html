<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>μ£Όλ¬Έ μ €μ¥ μ¤‘...</title>
</head>
<body>
  <h2>μ£Όλ¬Έ μ²λ¦¬ μ¤‘μ…λ‹λ‹¤...</h2>
  <script>
  const url = new URL(window.location.href);
  const impUid = url.searchParams.get("imp_uid");

  const saved = localStorage.getItem("pendingOrder");
  if (!saved) {
    alert("β μ£Όλ¬Έ μ •λ³΄κ°€ μ μ‹¤λμ—μµλ‹λ‹¤.");
  }

  const localData = JSON.parse(localStorage.getItem("pendingOrder") || '{}');
const orderData = {
  items: JSON.parse(localStorage.getItem("selectedItems") || '[]'),  // β… κ³ κΈ° ν’λ© ν¬ν•¨
  totalAmount: localData.totalAmount || '',
  contact: localData.contact || '',
  name: localData.name || '',
  address: localData.address || '',
  doorcode: localData.doorcode || '',
  requestMessage: localData.requestMessage || '',
  deliveryRequest: localData.deliveryRequest || '',
  paymentMethod: 'card',
  depositorName: '',
  cashReceipt: '',
  imp_uid: impUid,
  isPaid: true,
  token: localData.token || crypto.randomUUID()
};

console.log("π“¦ μ „μ†΅ν•  orderData:", orderData);

fetch("/submit-order", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify(orderData)
})
.then(res => res.json())
.then(data => {
  alert(data.message);
  location.href = "/success";
})
.catch(err => {
  console.error("β μ£Όλ¬Έ μ €μ¥ μ‹¤ν¨:", err);
  alert("μ„λ²„ μ¤λ¥λ΅ μ£Όλ¬Έ μ €μ¥ μ‹¤ν¨");
});
</script>
</body>
</html>
