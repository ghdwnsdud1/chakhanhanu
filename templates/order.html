<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì°©í•œí•œìš° ê³ ê¸° ì£¼ë¬¸ì„œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    h1, h2 {
      text-align: center;
    }
    select, input[type="number"], input[type="text"], textarea, button {
      width: 90%;
      padding: 12px;
      margin: 10px 0;
      font-size: 18px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    button:disabled {
      background-color: #ccc;
    }
    .important {
      color: red;
      margin-left: 5px;
    }
    .button-group {
      display: flex;
      gap: 10px;
      margin: 20px 0;
    }
    .button-group button {
      flex: 1;
    }
    #selectedItems, #requestSection, #addressSection, #paymentSection, #finalSection {
      margin-top: 20px;
      padding: 15px;
      background: #f9f9f9;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    .item {
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .item-buttons {
      display: flex;
      gap: 5px;
    }
    .action-btn {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
    }
    #finalAmount {
      font-size: 28px;
      text-align: center;
      margin-top: 10px;
      font-weight: bold;
    }
  </style>
</head>

<body>

<h1>ğŸ® ì°©í•œí•œìš° ğŸ·</h1>
<h2>ê³ ê¸° ì£¼ë¬¸ì„œ</h2>

<!-- ë¼ì§€ê³ ê¸° -->
<h2>ğŸ· ë¼ì§€ê³ ê¸° ì„ íƒ</h2>
<select id="porkSelect">
  <option value="">-- ë¶€ìœ„ ì„ íƒ --</option>
</select>
<input type="number" id="porkWeight" placeholder="ì¤‘ëŸ‰ (10g ë‹¨ìœ„)" step="10" min="10">
<button type="button" onclick="addItem('pork')">ì¶”ê°€í•˜ê¸°</button>

<!-- ì†Œê³ ê¸° -->
<h2>ğŸ® ì†Œê³ ê¸° ì„ íƒ</h2>
<select id="beefSelect">
  <option value="">-- ë¶€ìœ„ ì„ íƒ --</option>
</select>
<input type="number" id="beefWeight" placeholder="ì¤‘ëŸ‰ (10g ë‹¨ìœ„)" step="10" min="10">
<button type="button" onclick="addItem('beef')">ì¶”ê°€í•˜ê¸°</button>

<!-- ì–‘ë…ìœ¡ -->
<h2>ğŸ– ì–‘ë…ìœ¡ ì„ íƒ</h2>
<select id="marinatedSelect">
  <option value="">-- ì–‘ë…ìœ¡ì„ ì„ íƒí•˜ì„¸ìš” --</option>
  <option value="í•œìš° ì‚¬ê³¨ê³°íƒ•">í•œìš° ì‚¬ê³¨ê³°íƒ• (6,000ì›)</option>
  <option value="í•œìš° ê³ ê¸°ë“¬ë¿ ì‚¬ê³¨ê³°íƒ•">í•œìš° ê³ ê¸°ë“¬ë¿ ì‚¬ê³¨ê³°íƒ• (10,000ì›)</option>
  <option value="ê³ ì¶”ì¥ ìˆœì‚´ ë‹­ê°ˆë¹„" disabled>ê³ ì¶”ì¥ ìˆœì‚´ ë‹­ê°ˆë¹„ 700g (9,900ì›) - í’ˆì ˆ</option>
  <option value="í•œëˆ ê³ ì¶”ì¥ ë¶ˆê³ ê¸°" disabled>í•œëˆ ê³ ì¶”ì¥ ë¶ˆê³ ê¸° 800g (8,900ì›) - í’ˆì ˆ</option>
  <option value="í•œëˆ ìƒ ì–‘ë…ëª©ì‚´" disabled>í•œëˆ ìƒ ì–‘ë…ëª©ì‚´ 900g (14,800ì›) - í’ˆì ˆ</option>
  <option value="í•œìš° 1++ ì°¹ìŠ¤í…Œì´í¬" disabled>í•œìš° 1++ ì°¹ìŠ¤í…Œì´í¬ 360g (16,800ì›) - í’ˆì ˆ</option>
  <option value="ë„ˆë¥¼ ê½ ì°œë‹­" disabled>ë„ˆë¥¼ ê½ ì°œë‹­ ê³ ê¸°ë§Œ 800g (10,800ì›) - í’ˆì ˆ</option>
</select>
<input type="number" id="marinatedWeight" placeholder="ìˆ˜ëŸ‰ (1ê°œ ë‹¨ìœ„)" min="1" step="1">
<button type="button" onclick="addItem('marinated')">ì¶”ê°€í•˜ê¸°</button>

<hr>

<!-- ì„ íƒí•œ ìƒí’ˆ -->
<div id="selectedItems">
  <h2>ğŸ›’ ì„ íƒí•œ ìƒí’ˆ</h2>
  <div id="itemsList"></div>
  <div id="totalWeight">ì´ ì¤‘ëŸ‰: 0g</div>
  <div id="totalPrice">ì´ ê¸ˆì•¡: 0ì›</div>
</div>

<hr>

<!-- ìš”ì²­ì‚¬í•­ -->
<div id="requestSection">
  <h2>ğŸ“ ìš”ì²­ì‚¬í•­</h2>
  <textarea id="request" placeholder="ì¶”ê°€ ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”" rows="4"></textarea>
</div>

<hr>

<!-- ë°°ì†¡ì§€ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° -->
<div class="button-group">
  <button type="button" onclick="saveAddress()">ğŸ“¥ ë°°ì†¡ì§€ ì €ì¥</button>
  <button type="button" onclick="loadAddress()">ğŸ“¤ ë°°ì†¡ì§€ ë¶ˆëŸ¬ì˜¤ê¸°</button>
</div>

<!-- ë°°ì†¡ì§€ ì…ë ¥ -->
<div id="addressSection">
  <h2>ğŸ“¦ ë°°ì†¡ì§€ ì…ë ¥</h2>
  <input type="text" id="contact" placeholder="ì—°ë½ì²˜ (ì˜ˆ: 010-1234-5678)"> <span class="important">*</span>
  <input type="text" id="name" placeholder="ì´ë¦„"> <span class="important">*</span>
  <input type="text" id="address" placeholder="ì£¼ì†Œ"> <span class="important">*</span>
  <input type="text" id="doorcode" placeholder="ê³µë™í˜„ê´€ ë¹„ë°€ë²ˆí˜¸"> <span class="important">*</span>
  <textarea id="deliveryRequest" placeholder="ë°°ì†¡ ìš”ì²­ì‚¬í•­ (ì„ íƒ)" rows="3"></textarea>
</div>

<hr>

<!-- ê²°ì œ ë°©ë²• -->
<div id="paymentSection">
  <h2>ğŸ’³ ê²°ì œ ë°©ë²•</h2>
  <select id="paymentMethod" onchange="togglePaymentFields()">
    <option value="">-- ê²°ì œ ë°©ë²• ì„ íƒ --</option>
    <option value="account">ê³„ì¢Œì´ì²´</option>
    <option value="card">ì¹´ë“œê²°ì œ</option>
  </select> <span class="important">*</span>

  <div id="accountFields" style="display:none;">
    <input type="text" id="depositorName" placeholder="ì…ê¸ˆìëª…"> <span class="important">*</span>
    <input type="text" id="cashReceipt" placeholder="í˜„ê¸ˆì˜ìˆ˜ì¦ ë²ˆí˜¸ (ì„ íƒ)">
  </div>
</div>

<hr>

<!-- ì´ ê²°ì œ ê¸ˆì•¡ -->
<div id="finalSection">
  <h2>ğŸ§¾ ì´ ê²°ì œ ê¸ˆì•¡</h2>
  <div id="finalAmount">0ì›</div>
  <button id="submitButton" type="submit" disabled>ê²°ì œí•˜ê¸°</button>
</div>
<script>
// ğŸ”¥ ë¼ì§€ê³ ê¸°, ì†Œê³ ê¸°, ì–‘ë…ìœ¡ ê°€ê²©í‘œ
const porkList = {
  "ì‚¼ê²¹ì‚´": 2967, "ì˜¤ê²¹ì‚´": 3134, "ëª©ì‚´": 2634, "ì•ë‹¤ë¦¬ì‚´": 1650, "ì°Œê°œìš©": 1650,
  "ë“±ê°ˆë¹„": 2967, "ê°ˆë¹—ëŒ€ë²Œì§‘ì‚¼ê²¹ì‚´": 3300, "ìƒ ëŒ€íŒ¨ì‚¼ê²¹ì‚´": 2967, "ëˆ ë“±ì‹¬": 1650,
  "ëˆ ì•ˆì‹¬": 1650, "í•­ì •ì‚´": 6500, "ê°€ë¸Œë¦¬ì‚´(ë“±ì‹¬ë§ì‚´)": 5500, "ê°ˆë§¤ê¸°ì‚´": 5000,
  "ê¼¬ë“¤ì‚´": 3800, "ì• ì‚¬íƒœ(ê»ì§ˆO)": 1967, "ë¼ì§€ê°ˆë¹„": 1650
};
const beefList = {
  "í•œìš° ê½ƒë“±ì‹¬": 18800, "í•œìš° ì±„ëë“±ì‹¬": 18000, "í•œìš° ì•ˆì‹¬": 18800, "í•œìš° ì¹˜ë§ˆì‚´": 21800,
  "í•œìš° ì‚´ì¹˜ì‚´": 21800, "í•œìš° ê½ƒê°ˆë¹„ì‚´": 21800, "í•œìš° ë¶€ì±„ì‚´": 18000, "í•œìš° ì—…ì§„ì‚´": 18000,
  "í•œìš° ê°ˆë¹„ì‚´": 18000, "í•œìš° ì œë¹„ì¶”ë¦¬": 18000, "í•œìš° ì•ˆì°½ì‚´": 29800, "í•œìš° í† ì‹œì‚´": 21800,
  "í•œìš° ì–‘ì§€ êµ­ê±°ë¦¬": 7500, "í•œìš° ëª©ì‹¬ ì–‘ì§€": 6000, "í•œìš° ì‚¬íƒœ": 5000,
  "í•œìš° ìš°ë‘”ì‚´": 7000, "í•œìš° ë‹¤ì§ìœ¡": 7000, "í•œìš° ìœ¡íšŒ": 7500
};
const marinatedList = {
  "í•œìš° ì‚¬ê³¨ê³°íƒ•": 6000,
  "í•œìš° ê³ ê¸°ë“¬ë¿ ì‚¬ê³¨ê³°íƒ•": 10000,
  "ê³ ì¶”ì¥ ìˆœì‚´ ë‹­ê°ˆë¹„": 9900,
  "í•œëˆ ê³ ì¶”ì¥ ë¶ˆê³ ê¸°": 8900,
  "í•œëˆ ìƒ ì–‘ë…ëª©ì‚´": 14800,
  "í•œìš° 1++ ì°¹ìŠ¤í…Œì´í¬": 16800,
  "ë„ˆë¥¼ ê½ ì°œë‹­": 10800
};

let selectedItems = [];

// ğŸ”¥ ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸°
for (let meat in porkList) {
  const opt = document.createElement('option');
  opt.value = meat;
  opt.textContent = `${meat} (100g ${porkList[meat]}ì›)`;
  document.getElementById('porkSelect').appendChild(opt);
}
for (let meat in beefList) {
  const opt = document.createElement('option');
  opt.value = meat;
  opt.textContent = `${meat} (100g ${beefList[meat]}ì›)`;
  document.getElementById('beefSelect').appendChild(opt);
}

// ğŸ”¥ ê³ ê¸°/ì–‘ë… ì¶”ê°€
function addItem(type) {
  let select, weightInput, priceList;

  if (type === 'pork') {
    select = document.getElementById('porkSelect');
    weightInput = document.getElementById('porkWeight');
    priceList = porkList;
  } else if (type === 'beef') {
    select = document.getElementById('beefSelect');
    weightInput = document.getElementById('beefWeight');
    priceList = beefList;
  } else {
    select = document.getElementById('marinatedSelect');
    weightInput = document.getElementById('marinatedWeight');
    priceList = marinatedList;
  }

  const meat = select.value;
  let weight = parseInt(weightInput.value);

  if (!meat || isNaN(weight) || weight <= 0) {
    alert('ë¶€ìœ„ì™€ ì¤‘ëŸ‰(ë˜ëŠ” ìˆ˜ëŸ‰)ì„ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  if ((type !== 'marinated') && (weight % 10 !== 0)) {
    alert('ê³ ê¸°ëŠ” 10g ë‹¨ìœ„ë¡œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.');
    return;
  }

  const pricePerUnit = priceList[meat];
  const existing = selectedItems.find(item => item.meat === meat);

  if (existing) {
    existing.weight += weight;
  } else {
    selectedItems.push({ meat, weight, pricePerUnit, type });
  }

  select.value = "";
  weightInput.value = "";
  updateList();
}

// ğŸ”¥ ìƒí’ˆ ëª©ë¡ ì—…ë°ì´íŠ¸
function updateList() {
  const itemsList = document.getElementById('itemsList');
  itemsList.innerHTML = '';

  let totalWeight = 0;
  let totalCount = 0;
  let totalPrice = 0;

  selectedItems.forEach((item, index) => {
    let itemPrice = 0;
    if (item.type === 'marinated') {
      itemPrice = item.weight * item.pricePerUnit;
      totalCount += item.weight;
    } else {
      itemPrice = Math.floor(item.weight * item.pricePerUnit / 100);
      totalWeight += item.weight;
    }

    const div = document.createElement('div');
    div.className = 'item';
    div.innerHTML = `
      ${item.meat} - ${item.weight}${item.type === 'marinated' ? 'ê°œ' : 'g'} - ${itemPrice.toLocaleString()}ì›
      <div class="item-buttons">
        <button class="action-btn" onclick="editItem(${index})">âœï¸</button>
        <button class="action-btn" onclick="removeItem(${index})">ğŸ—‘ï¸</button>
      </div>
    `;
    itemsList.appendChild(div);

    totalPrice += itemPrice;
  });

  const roundedPrice = Math.floor(totalPrice / 100) * 100;

  document.getElementById('totalWeight').textContent = `ì´ ì¤‘ëŸ‰: ${totalWeight}g / ì´ ìˆ˜ëŸ‰: ${totalCount}ê°œ`;
  document.getElementById('totalPrice').textContent = `ì´ ê¸ˆì•¡: ${roundedPrice.toLocaleString()}ì›`;
  document.getElementById('finalAmount').textContent = `${roundedPrice.toLocaleString()}ì›`;

  checkSubmitEnabled();
}

// ğŸ”¥ ìˆ˜ì •/ì‚­ì œ
function editItem(index) {
  const item = selectedItems[index];
  const message = item.type === 'marinated' ? "ìƒˆ ìˆ˜ëŸ‰ (ê°œ ë‹¨ìœ„)" : "ìƒˆ ì¤‘ëŸ‰ (10g ë‹¨ìœ„)";
  const newWeight = prompt(message, item.weight);

  if (newWeight !== null) {
    const parsed = parseInt(newWeight);
    if (!isNaN(parsed)) {
      if (item.type === 'marinated' || parsed % 10 === 0) {
        selectedItems[index].weight = parsed;
        updateList();
      } else {
        alert("ê³ ê¸°ëŠ” 10g ë‹¨ìœ„ë¡œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.");
      }
    } else {
      alert("ìˆ«ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    }
  }
}
function removeItem(index) {
  selectedItems.splice(index, 1);
  updateList();
}

// ğŸ”¥ ê²°ì œ ë°©ë²• ë³€ê²½
function togglePaymentFields() {
  const method = document.getElementById('paymentMethod').value;
  document.getElementById('accountFields').style.display = method === 'account' ? 'block' : 'none';
}

// ğŸ”¥ ë°°ì†¡ì§€ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
function saveAddress() {
  const info = {
    contact: document.getElementById('contact').value,
    name: document.getElementById('name').value,
    address: document.getElementById('address').value,
    doorcode: document.getElementById('doorcode').value,
    deliveryRequest: document.getElementById('deliveryRequest').value
  };
  localStorage.setItem('shippingInfo', JSON.stringify(info));
  alert('ë°°ì†¡ì§€ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
}
function loadAddress() {
  const saved = localStorage.getItem('shippingInfo');
  if (saved) {
    const info = JSON.parse(saved);
    document.getElementById('contact').value = info.contact || '';
    document.getElementById('name').value = info.name || '';
    document.getElementById('address').value = info.address || '';
    document.getElementById('doorcode').value = info.doorcode || '';
    document.getElementById('deliveryRequest').value = info.deliveryRequest || '';
    alert('ë°°ì†¡ì§€ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!');
  } else {
    alert('ì €ì¥ëœ ë°°ì†¡ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.');
  }
}

// ğŸ”¥ ì—°ë½ì²˜ ìë™ í•˜ì´í”ˆ
document.getElementById('contact').addEventListener('input', function(e) {
  let num = e.target.value.replace(/\D/g, '');
  if (num.length < 4) e.target.value = num;
  else if (num.length < 8) e.target.value = `${num.slice(0, 3)}-${num.slice(3)}`;
  else e.target.value = `${num.slice(0, 3)}-${num.slice(3, 7)}-${num.slice(7, 11)}`;
});

// ğŸ”¥ ì£¼ë¬¸ ì„œë²„ ì „ì†¡
document.getElementById('submitButton').addEventListener('click', submitOrder);

function submitOrder() {
  const orderData = {
    items: selectedItems,
    totalAmount: document.getElementById('finalAmount').innerText,
    contact: document.getElementById('contact').value,
    name: document.getElementById('name').value,
    address: document.getElementById('address').value,
    doorcode: document.getElementById('doorcode').value,
    requestMessage: document.getElementById('request').value,
    deliveryRequest: document.getElementById('deliveryRequest').value,
    paymentMethod: document.getElementById('paymentMethod').value,
    depositorName: document.getElementById('depositorName') ? document.getElementById('depositorName').value : '',
    cashReceipt: document.getElementById('cashReceipt') ? document.getElementById('cashReceipt').value : ''
  };

  fetch('/submit-order', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(orderData)
  })
  .then(response => response.json())
  .then(data => {
    alert('ì£¼ë¬¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰');
    console.log(data);
  })
  .catch(error => {
    alert('ì£¼ë¬¸ ì‹¤íŒ¨ ğŸ˜¥');
    console.error(error);
  });
}

// ğŸ”¥ ë²„íŠ¼ í™œì„±í™” ì²´í¬
function checkSubmitEnabled() {
  const hasItems = selectedItems.length > 0;
  const hasContact = document.getElementById('contact').value.trim() !== '';
  const hasName = document.getElementById('name').value.trim() !== '';
  const hasAddress = document.getElementById('address').value.trim() !== '';
  const hasPayment = document.getElementById('paymentMethod').value.trim() !== '';

  const submitButton = document.getElementById('submitButton');
  submitButton.disabled = !(hasItems && hasContact && hasName && hasAddress && hasPayment);
}

// ğŸ”¥ ì…ë ¥ ë³€í™” ê°ì§€
document.getElementById('contact').addEventListener('input', checkSubmitEnabled);
document.getElementById('name').addEventListener('input', checkSubmitEnabled);
document.getElementById('address').addEventListener('input', checkSubmitEnabled);
document.getElementById('paymentMethod').addEventListener('change', checkSubmitEnabled);

</script>
</body>
</html>
