<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì°©í•œí•œìš° ê³ ê¸° ì£¼ë¬¸ì„œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    h1, h2 {
      text-align: center;
    }
    select, input[type="number"], button, textarea, input[type="text"] {
      margin: 10px 0;
      padding: 12px;
      font-size: 18px;
      width: 100%;
      box-sizing: border-box;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #45a049;
    }
    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    .important {
      color: red;
      margin-left: 5px;
    }
    #selectedItems, #requestSection, #addressSection, #paymentSection, #finalSection {
      margin-top: 20px;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background-color: #f9f9f9;
    }
    .item {
      margin-bottom: 8px;
      font-size: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .item-buttons {
      display: flex;
      gap: 5px;
    }
    .action-btn {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
    }
    .button-group {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    hr {
      margin: 30px 0;
      border: 0;
      border-top: 1px solid #ccc;
    }
  </style>
</head>

<body>

<h1>ğŸ® ì°©í•œí•œìš° ğŸ·</h1>

<h2>ê³ ê¸° ì£¼ë¬¸ì„œ</h2>

<form method="POST" action="/submit" id="orderForm">

  <h2>ğŸ· ë¼ì§€ê³ ê¸° ì„ íƒ</h2>
  <select id="porkSelect">
    <option value="">-- ë¼ì§€ê³ ê¸° ë¶€ìœ„ë¥¼ ì„ íƒí•˜ì„¸ìš” --</option>
  </select>
  <input type="number" id="porkWeight" placeholder="ì¤‘ëŸ‰ (10g ë‹¨ìœ„)" step="10" min="10">
  <button type="button" onclick="addItem('pork')">ì¶”ê°€í•˜ê¸°</button>

  <h2>ğŸ® ì†Œê³ ê¸° ì„ íƒ</h2>
  <select id="beefSelect">
    <option value="">-- ì†Œê³ ê¸° ë¶€ìœ„ë¥¼ ì„ íƒí•˜ì„¸ìš” --</option>
  </select>
  <input type="number" id="beefWeight" placeholder="ì¤‘ëŸ‰ (10g ë‹¨ìœ„)" step="10" min="10">
  <button type="button" onclick="addItem('beef')">ì¶”ê°€í•˜ê¸°</button>

  <hr>

  <div id="selectedItems">
    <h2>ğŸ›’ ì„ íƒí•œ ìƒí’ˆ</h2>
    <div id="itemsList"></div>
    <div id="totalWeight">ì´ ì¤‘ëŸ‰: 0g</div>
    <div id="totalPrice">ì´ ê¸ˆì•¡: 0ì›</div>
  </div>

  <hr>

  <div id="requestSection">
    <h2>ğŸ“ ìš”ì²­ì‚¬í•­</h2>
    <textarea id="request" name="request_message" placeholder="ì¶”ê°€ ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”" rows="4"></textarea>
  </div>

  <hr>

  <div class="button-group">
    <button type="button" onclick="saveAddress()">ğŸ“¥ ë°°ì†¡ì§€ ì €ì¥</button>
    <button type="button" onclick="loadAddress()">ğŸ“¤ ë°°ì†¡ì§€ ë¶ˆëŸ¬ì˜¤ê¸°</button>
  </div>

  <div id="addressSection">
    <h2>ğŸ“¦ ë°°ì†¡ì§€ ì…ë ¥</h2>

    <div style="display: flex; align-items: center; gap: 8px;">
      <input type="text" id="contact" name="contact" placeholder="ì—°ë½ì²˜ (ì˜ˆ: 010-1234-5678)">
      <span class="important">*</span>
    </div>
    <small style="color: gray; font-size: 14px;">â€» ì—°ë½ì²˜ëŠ” 010-1234-5678 í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.</small>

    <div style="display: flex; align-items: center; gap: 8px; margin-top: 10px;">
      <input type="text" id="name" name="name" placeholder="ì´ë¦„">
      <span class="important">*</span>
    </div>

    <div style="display: flex; align-items: center; gap: 8px;">
      <input type="text" id="address" name="address" placeholder="ì£¼ì†Œ">
      <span class="important">*</span>
    </div>

    <div style="display: flex; align-items: center; gap: 8px;">
      <input type="text" id="doorcode" name="doorcode" placeholder="ê³µë™í˜„ê´€ ë¹„ë°€ë²ˆí˜¸">
      <span class="important">*</span>
    </div>

    <textarea id="deliveryRequest" name="delivery_request" placeholder="ë°°ì†¡ ê´€ë ¨ ìš”ì²­ì‚¬í•­ (ì„ íƒ)" rows="3" style="margin-top: 10px;"></textarea>
  </div>

  <hr>

  <div id="paymentSection">
    <h2>ğŸ’³ ê²°ì œ ë°©ë²•</h2>

    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
      <select id="paymentMethod" name="payment_method" onchange="togglePaymentFields()">
        <option value="">-- ê²°ì œ ë°©ë²•ì„ ì„ íƒí•˜ì„¸ìš” --</option>
        <option value="account">ê³„ì¢Œì´ì²´</option>
        <option value="card">ì¹´ë“œê²°ì œ</option>
      </select>
      <span class="important">*</span>
    </div>

    <div id="accountFields" style="display: none;">
      <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
        <input type="text" id="depositorName" name="depositor_name" placeholder="ì…ê¸ˆìëª…">
        <span class="important">*</span>
      </div>

      <input type="text" id="cashReceipt" name="cash_receipt" placeholder="í˜„ê¸ˆì˜ìˆ˜ì¦ ë²ˆí˜¸ (ì„ íƒ)" style="margin-bottom: 10px;">
    </div>
  </div>

  <hr>

  <div id="finalSection" style="text-align: center;">
    <h2>ğŸ§¾ ì´ ê²°ì œ ê¸ˆì•¡</h2>
    <div id="finalAmount" style="font-size: 24px; margin-bottom: 20px;">0ì›</div>

    <!-- ì´ ê²°ì œ ê¸ˆì•¡ê³¼ ì„ íƒí•œ ê³ ê¸° ìˆ¨ê¸°ê¸° -->
    <input type="hidden" id="formTotalAmount" name="total_amount">
    <input type="hidden" id="selectedItemsInput" name="selected_items">

    <button id="submitButton" type="submit" disabled>ê²°ì œí•˜ê¸°</button>
  </div>

</form>

<script>
// === JavaScriptëŠ” ë°”ë¡œ ì´ì–´ì„œ ì¤„ê²Œ! (ë°”ë¡œ ê³„ì† ë³´ë‚´ì)
</script>

</body>
</html>
<script>
/* ê³ ê¸° ëª©ë¡ */
const porkList = { "ì‚¼ê²¹ì‚´": 2967, "ì˜¤ê²¹ì‚´": 3134, "ëª©ì‚´": 2634, "ì•ë‹¤ë¦¬ì‚´": 1650, "ì°Œê°œìš©": 1650, "ë“±ê°ˆë¹„": 2967, "ê°ˆë¹—ëŒ€ë²Œì§‘ì‚¼ê²¹ì‚´": 3300, "ìƒ ëŒ€íŒ¨ì‚¼ê²¹ì‚´": 2967, "ëˆ ë“±ì‹¬": 1650, "ëˆ ì•ˆì‹¬": 1650, "í•­ì •ì‚´": 6500, "ê°€ë¸Œë¦¬ì‚´(ë“±ì‹¬ë§ì‚´)": 5500, "ê°ˆë§¤ê¸°ì‚´": 5000, "ê¼¬ë“¤ì‚´": 3800, "ì• ì‚¬íƒœ(ê»ì§ˆO)": 1967, "ë¼ì§€ê°ˆë¹„": 1650 };
const beefList = { "í•œìš° ê½ƒë“±ì‹¬": 18800, "í•œìš° ì±„ëë“±ì‹¬": 18000, "í•œìš° ì•ˆì‹¬": 18800, "í•œìš° ì¹˜ë§ˆì‚´": 21800, "í•œìš° ì‚´ì¹˜ì‚´": 21800, "í•œìš° ê½ƒê°ˆë¹„ì‚´": 21800, "í•œìš° ë¶€ì±„ì‚´": 18000, "í•œìš° ì—…ì§„ì‚´": 18000, "í•œìš° ê°ˆë¹„ì‚´": 18000, "í•œìš° ì œë¹„ì¶”ë¦¬": 18000, "í•œìš° ì•ˆì°½ì‚´": 29800, "í•œìš° í† ì‹œì‚´": 21800, "í•œìš° ì–‘ì§€ êµ­ê±°ë¦¬": 7500, "í•œìš° ëª©ì‹¬ ì–‘ì§€": 6000, "í•œìš° ì‚¬íƒœ": 5000, "í•œìš° ìš°ë‘”ì‚´": 7000, "í•œìš° ë‹¤ì§ìœ¡": 7000, "í•œìš° ìœ¡íšŒ": 7500 };

const porkSelect = document.getElementById('porkSelect');
const beefSelect = document.getElementById('beefSelect');

for (let meat in porkList) {
  const option = document.createElement('option');
  option.value = meat;
  option.textContent = `${meat} (100g ${porkList[meat]}ì›)`;
  porkSelect.appendChild(option);
}
for (let meat in beefList) {
  const option = document.createElement('option');
  option.value = meat;
  option.textContent = `${meat} (100g ${beefList[meat]}ì›)`;
  beefSelect.appendChild(option);
}

let selectedItems = [];

function addItem(type) {
  let select, weightInput, priceList;
  if (type === 'pork') {
    select = document.getElementById('porkSelect');
    weightInput = document.getElementById('porkWeight');
    priceList = porkList;
  } else {
    select = document.getElementById('beefSelect');
    weightInput = document.getElementById('beefWeight');
    priceList = beefList;
  }

  const meat = select.value;
  const weight = parseInt(weightInput.value);

  if (!meat || isNaN(weight) || weight <= 0 || weight % 10 !== 0) {
    alert('ê³ ê¸° ë¶€ìœ„ì™€ ì¤‘ëŸ‰ì„ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”. (10g ë‹¨ìœ„)');
    return;
  }

  const existing = selectedItems.find(item => item.meat === meat);
  if (existing) {
    existing.weight += weight;
  } else {
    selectedItems.push({ meat, weight, pricePer100g: priceList[meat] });
  }
  updateList();
  select.value = "";
  weightInput.value = "";
}

function updateList() {
  const itemsList = document.getElementById('itemsList');
  itemsList.innerHTML = '';

  let totalWeight = 0;
  let totalPrice = 0;

  selectedItems.forEach((item, index) => {
    const itemPrice = Math.floor(item.weight * item.pricePer100g / 100);
    const div = document.createElement('div');
    div.className = 'item';
    div.innerHTML = `
      ${item.meat} - ${item.weight}g - ${itemPrice.toLocaleString()}ì›
      <div class="item-buttons">
        <button class="action-btn" type="button" onclick="editItem(${index})">âœï¸</button>
        <button class="action-btn" type="button" onclick="removeItem(${index})">ğŸ—‘ï¸</button>
      </div>
    `;
    itemsList.appendChild(div);

    totalWeight += item.weight;
    totalPrice += itemPrice;
  });

  const roundedPrice = Math.floor(totalPrice / 100) * 100;
  document.getElementById('totalWeight').textContent = `ì´ ì¤‘ëŸ‰: ${totalWeight}g`;
  document.getElementById('totalPrice').textContent = `ì´ ê¸ˆì•¡: ${roundedPrice.toLocaleString()}ì›`;
  document.getElementById('finalAmount').textContent = `${roundedPrice.toLocaleString()}ì›`;
  document.getElementById('formTotalAmount').value = roundedPrice;

  document.getElementById('selectedItemsInput').value = JSON.stringify(selectedItems);
}

function editItem(index) {
  const newWeight = prompt("ìƒˆë¡œìš´ ì¤‘ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš” (10g ë‹¨ìœ„)", selectedItems[index].weight);
  if (newWeight !== null) {
    const parsedWeight = parseInt(newWeight);
    if (!isNaN(parsedWeight) && parsedWeight > 0 && parsedWeight % 10 === 0) {
      selectedItems[index].weight = parsedWeight;
      updateList();
    } else {
      alert("10g ë‹¨ìœ„ì˜ ìˆ«ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    }
  }
}

function removeItem(index) {
  selectedItems.splice(index, 1);
  updateList();
}

function togglePaymentFields() {
  const method = document.getElementById('paymentMethod').value;
  const accountFields = document.getElementById('accountFields');
  accountFields.style.display = method === 'account' ? 'block' : 'none';
  validateForm();
}

function validateForm() {
  const contact = document.getElementById('contact').value.trim();
  const name = document.getElementById('name').value.trim();
  const address = document.getElementById('address').value.trim();
  const doorcode = document.getElementById('doorcode').value.trim();
  const paymentMethod = document.getElementById('paymentMethod').value;
  const depositorName = document.getElementById('depositorName')?.value.trim() || '';

  let isValid = contact && name && address && doorcode && paymentMethod;
  if (paymentMethod === 'account') {
    isValid = isValid && depositorName;
  }

  document.getElementById('submitButton').disabled = !isValid;
}

function saveAddress() {
  const shippingInfo = {
    contact: document.getElementById('contact').value,
    name: document.getElementById('name').value,
    address: document.getElementById('address').value,
    doorcode: document.getElementById('doorcode').value,
    deliveryRequest: document.getElementById('deliveryRequest').value
  };
  localStorage.setItem('shippingInfo', JSON.stringify(shippingInfo));
  alert('ë°°ì†¡ì§€ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
}

function loadAddress() {
  const saved = localStorage.getItem('shippingInfo');
  if (saved) {
    const shippingInfo = JSON.parse(saved);
    document.getElementById('contact').value = shippingInfo.contact || '';
    document.getElementById('name').value = shippingInfo.name || '';
    document.getElementById('address').value = shippingInfo.address || '';
    document.getElementById('doorcode').value = shippingInfo.doorcode || '';
    document.getElementById('deliveryRequest').value = shippingInfo.deliveryRequest || '';
    validateForm();
    alert('ë°°ì†¡ì§€ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!');
  } else {
    alert('ì €ì¥ëœ ë°°ì†¡ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.');
  }
}

document.getElementById('contact').addEventListener('input', function(e) {
  let number = e.target.value.replace(/[^0-9]/g, '');
  let formatted = number.length < 4 ? number : number.length < 8 ? number.slice(0, 3) + '-' + number.slice(3) : number.slice(0, 3) + '-' + number.slice(3, 7) + '-' + number.slice(7);
  e.target.value = formatted;
});

['contact', 'name', 'address', 'doorcode', 'paymentMethod'].forEach(id => {
  document.getElementById(id).addEventListener('input', validateForm);
});
</script>
