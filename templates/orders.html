<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>착한한우 고기 주문서</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    h1, h2 {
      text-align: center;
    }
    select, input[type="number"], button, textarea, input[type="text"] {
      margin: 10px 0;
      padding: 12px;
      font-size: 18px;
      width: 100%;
      box-sizing: border-box;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #45a049;
    }
    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    .important {
      color: red;
      margin-left: 5px;
    }
    #selectedItems, #requestSection, #addressSection, #paymentSection, #finalSection {
      margin-top: 20px;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background-color: #f9f9f9;
    }
    .item {
      margin-bottom: 8px;
      font-size: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .item-buttons {
      display: flex;
      gap: 5px;
    }
    .action-btn {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
    }
    .button-group {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    hr {
      margin: 30px 0;
      border: 0;
      border-top: 1px solid #ccc;
    }
  </style>
</head>

<body>

<h1>🐮 착한한우 🐷</h1>

<h2>고기 주문서</h2>

<form method="POST" action="/submit" id="orderForm">

  <h2>🐷 돼지고기 선택</h2>
  <select id="porkSelect">
    <option value="">-- 돼지고기 부위를 선택하세요 --</option>
  </select>
  <input type="number" id="porkWeight" placeholder="중량 (10g 단위)" step="10" min="10">
  <button type="button" onclick="addItem('pork')">추가하기</button>

  <h2>🐮 소고기 선택</h2>
  <select id="beefSelect">
    <option value="">-- 소고기 부위를 선택하세요 --</option>
  </select>
  <input type="number" id="beefWeight" placeholder="중량 (10g 단위)" step="10" min="10">
  <button type="button" onclick="addItem('beef')">추가하기</button>

  <hr>

  <div id="selectedItems">
    <h2>🛒 선택한 상품</h2>
    <div id="itemsList"></div>
    <div id="totalWeight">총 중량: 0g</div>
    <div id="totalPrice">총 금액: 0원</div>
  </div>

  <hr>

  <div id="requestSection">
    <h2>📝 요청사항</h2>
    <textarea id="request" name="request_message" placeholder="추가 요청사항을 입력하세요" rows="4"></textarea>
  </div>

  <hr>

  <div class="button-group">
    <button type="button" onclick="saveAddress()">📥 배송지 저장</button>
    <button type="button" onclick="loadAddress()">📤 배송지 불러오기</button>
  </div>

  <div id="addressSection">
    <h2>📦 배송지 입력</h2>

    <div style="display: flex; align-items: center; gap: 8px;">
      <input type="text" id="contact" name="contact" placeholder="연락처 (예: 010-1234-5678)">
      <span class="important">*</span>
    </div>
    <small style="color: gray; font-size: 14px;">※ 연락처는 010-1234-5678 형식으로 입력해주세요.</small>

    <div style="display: flex; align-items: center; gap: 8px; margin-top: 10px;">
      <input type="text" id="name" name="name" placeholder="이름">
      <span class="important">*</span>
    </div>

    <div style="display: flex; align-items: center; gap: 8px;">
      <input type="text" id="address" name="address" placeholder="주소">
      <span class="important">*</span>
    </div>

    <div style="display: flex; align-items: center; gap: 8px;">
      <input type="text" id="doorcode" name="doorcode" placeholder="공동현관 비밀번호">
      <span class="important">*</span>
    </div>

    <textarea id="deliveryRequest" name="delivery_request" placeholder="배송 관련 요청사항 (선택)" rows="3" style="margin-top: 10px;"></textarea>
  </div>

  <hr>

  <div id="paymentSection">
    <h2>💳 결제 방법</h2>

    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
      <select id="paymentMethod" name="payment_method" onchange="togglePaymentFields()">
        <option value="">-- 결제 방법을 선택하세요 --</option>
        <option value="account">계좌이체</option>
        <option value="card">카드결제</option>
      </select>
      <span class="important">*</span>
    </div>

    <div id="accountFields" style="display: none;">
      <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
        <input type="text" id="depositorName" name="depositor_name" placeholder="입금자명">
        <span class="important">*</span>
      </div>

      <input type="text" id="cashReceipt" name="cash_receipt" placeholder="현금영수증 번호 (선택)" style="margin-bottom: 10px;">
    </div>
  </div>

  <hr>

  <div id="finalSection" style="text-align: center;">
    <h2>🧾 총 결제 금액</h2>
    <div id="finalAmount" style="font-size: 24px; margin-bottom: 20px;">0원</div>

    <!-- 총 결제 금액과 선택한 고기 숨기기 -->
    <input type="hidden" id="formTotalAmount" name="total_amount">
    <input type="hidden" id="selectedItemsInput" name="selected_items">

    <button id="submitButton" type="submit" disabled>결제하기</button>
  </div>

</form>

<script>
// === JavaScript는 바로 이어서 줄게! (바로 계속 보내자)
</script>

</body>
</html>
<script>
/* 고기 목록 */
const porkList = { "삼겹살": 2967, "오겹살": 3134, "목살": 2634, "앞다리살": 1650, "찌개용": 1650, "등갈비": 2967, "갈빗대벌집삼겹살": 3300, "생 대패삼겹살": 2967, "돈 등심": 1650, "돈 안심": 1650, "항정살": 6500, "가브리살(등심덧살)": 5500, "갈매기살": 5000, "꼬들살": 3800, "앞 사태(껍질O)": 1967, "돼지갈비": 1650 };
const beefList = { "한우 꽃등심": 18800, "한우 채끝등심": 18000, "한우 안심": 18800, "한우 치마살": 21800, "한우 살치살": 21800, "한우 꽃갈비살": 21800, "한우 부채살": 18000, "한우 업진살": 18000, "한우 갈비살": 18000, "한우 제비추리": 18000, "한우 안창살": 29800, "한우 토시살": 21800, "한우 양지 국거리": 7500, "한우 목심 양지": 6000, "한우 사태": 5000, "한우 우둔살": 7000, "한우 다짐육": 7000, "한우 육회": 7500 };

const porkSelect = document.getElementById('porkSelect');
const beefSelect = document.getElementById('beefSelect');

for (let meat in porkList) {
  const option = document.createElement('option');
  option.value = meat;
  option.textContent = `${meat} (100g ${porkList[meat]}원)`;
  porkSelect.appendChild(option);
}
for (let meat in beefList) {
  const option = document.createElement('option');
  option.value = meat;
  option.textContent = `${meat} (100g ${beefList[meat]}원)`;
  beefSelect.appendChild(option);
}

let selectedItems = [];

function addItem(type) {
  let select, weightInput, priceList;
  if (type === 'pork') {
    select = document.getElementById('porkSelect');
    weightInput = document.getElementById('porkWeight');
    priceList = porkList;
  } else {
    select = document.getElementById('beefSelect');
    weightInput = document.getElementById('beefWeight');
    priceList = beefList;
  }

  const meat = select.value;
  const weight = parseInt(weightInput.value);

  if (!meat || isNaN(weight) || weight <= 0 || weight % 10 !== 0) {
    alert('고기 부위와 중량을 정확히 입력해주세요. (10g 단위)');
    return;
  }

  const existing = selectedItems.find(item => item.meat === meat);
  if (existing) {
    existing.weight += weight;
  } else {
    selectedItems.push({ meat, weight, pricePer100g: priceList[meat] });
  }
  updateList();
  select.value = "";
  weightInput.value = "";
}

function updateList() {
  const itemsList = document.getElementById('itemsList');
  itemsList.innerHTML = '';

  let totalWeight = 0;
  let totalPrice = 0;

  selectedItems.forEach((item, index) => {
    const itemPrice = Math.floor(item.weight * item.pricePer100g / 100);
    const div = document.createElement('div');
    div.className = 'item';
    div.innerHTML = `
      ${item.meat} - ${item.weight}g - ${itemPrice.toLocaleString()}원
      <div class="item-buttons">
        <button class="action-btn" type="button" onclick="editItem(${index})">✏️</button>
        <button class="action-btn" type="button" onclick="removeItem(${index})">🗑️</button>
      </div>
    `;
    itemsList.appendChild(div);

    totalWeight += item.weight;
    totalPrice += itemPrice;
  });

  const roundedPrice = Math.floor(totalPrice / 100) * 100;
  document.getElementById('totalWeight').textContent = `총 중량: ${totalWeight}g`;
  document.getElementById('totalPrice').textContent = `총 금액: ${roundedPrice.toLocaleString()}원`;
  document.getElementById('finalAmount').textContent = `${roundedPrice.toLocaleString()}원`;
  document.getElementById('formTotalAmount').value = roundedPrice;

  document.getElementById('selectedItemsInput').value = JSON.stringify(selectedItems);
}

function editItem(index) {
  const newWeight = prompt("새로운 중량을 입력하세요 (10g 단위)", selectedItems[index].weight);
  if (newWeight !== null) {
    const parsedWeight = parseInt(newWeight);
    if (!isNaN(parsedWeight) && parsedWeight > 0 && parsedWeight % 10 === 0) {
      selectedItems[index].weight = parsedWeight;
      updateList();
    } else {
      alert("10g 단위의 숫자로 입력해주세요.");
    }
  }
}

function removeItem(index) {
  selectedItems.splice(index, 1);
  updateList();
}

function togglePaymentFields() {
  const method = document.getElementById('paymentMethod').value;
  const accountFields = document.getElementById('accountFields');
  accountFields.style.display = method === 'account' ? 'block' : 'none';
  validateForm();
}

function validateForm() {
  const contact = document.getElementById('contact').value.trim();
  const name = document.getElementById('name').value.trim();
  const address = document.getElementById('address').value.trim();
  const doorcode = document.getElementById('doorcode').value.trim();
  const paymentMethod = document.getElementById('paymentMethod').value;
  const depositorName = document.getElementById('depositorName')?.value.trim() || '';

  let isValid = contact && name && address && doorcode && paymentMethod;
  if (paymentMethod === 'account') {
    isValid = isValid && depositorName;
  }

  document.getElementById('submitButton').disabled = !isValid;
}

function saveAddress() {
  const shippingInfo = {
    contact: document.getElementById('contact').value,
    name: document.getElementById('name').value,
    address: document.getElementById('address').value,
    doorcode: document.getElementById('doorcode').value,
    deliveryRequest: document.getElementById('deliveryRequest').value
  };
  localStorage.setItem('shippingInfo', JSON.stringify(shippingInfo));
  alert('배송지가 저장되었습니다!');
}

function loadAddress() {
  const saved = localStorage.getItem('shippingInfo');
  if (saved) {
    const shippingInfo = JSON.parse(saved);
    document.getElementById('contact').value = shippingInfo.contact || '';
    document.getElementById('name').value = shippingInfo.name || '';
    document.getElementById('address').value = shippingInfo.address || '';
    document.getElementById('doorcode').value = shippingInfo.doorcode || '';
    document.getElementById('deliveryRequest').value = shippingInfo.deliveryRequest || '';
    validateForm();
    alert('배송지를 불러왔습니다!');
  } else {
    alert('저장된 배송지가 없습니다.');
  }
}

document.getElementById('contact').addEventListener('input', function(e) {
  let number = e.target.value.replace(/[^0-9]/g, '');
  let formatted = number.length < 4 ? number : number.length < 8 ? number.slice(0, 3) + '-' + number.slice(3) : number.slice(0, 3) + '-' + number.slice(3, 7) + '-' + number.slice(7);
  e.target.value = formatted;
});

['contact', 'name', 'address', 'doorcode', 'paymentMethod'].forEach(id => {
  document.getElementById(id).addEventListener('input', validateForm);
});
</script>
